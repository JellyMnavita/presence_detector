<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Système de Sécurité Biométrique</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
        }
        
        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .header p {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 300;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            margin-top: 20px;
            padding: 12px 24px;
            background: rgba(34, 197, 94, 0.2);
            border-radius: 25px;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .pulse {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border-radius: 50%;
            margin-right: 12px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        
        .controls {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .refresh-btn {
            background: linear-gradient(45deg, #374151, #4b5563);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .refresh-btn:hover {
            background: linear-gradient(45deg, #4b5563, #6b7280);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        
        .refresh-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(0,0,0,0.4);
        }
        
        .refresh-btn.loading {
            pointer-events: none;
        }
        
        .refresh-btn.loading i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .about-content {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 800px;
            margin: 0 auto;
            color: white;
        }
        
        .profile-section {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            margin: 0 auto 20px;
        }
        
        .profile-name {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .profile-title {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
        }
        
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .skill-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .skill-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #6366f1;
        }
        
        .skill-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .skill-desc {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .footer {
            margin-top: 50px;
            padding: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .footer p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin: 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
        }
        
        .stat-card.security::before { background: linear-gradient(45deg, #22c55e, #16a34a); }
        .stat-card.alert::before { background: linear-gradient(45deg, #ef4444, #dc2626); }
        .stat-card.performance::before { background: linear-gradient(45deg, #f59e0b, #d97706); }
        
        .stat-icon {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .stat-value {
            font-size: 2.8rem;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .stat-trend {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 400;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container, .events-section {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-header {
            margin-bottom: 25px;
            text-align: center;
        }
        
        .section-header h3 {
            font-size: 1.4rem;
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
        }
        
        .section-header p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        .events-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .events-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .event-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border-left: 4px solid #6366f1;
            transition: all 0.3s ease;
        }
        
        .event-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .event-item.authorized {
            border-left-color: #22c55e;
        }
        
        .event-item.unauthorized {
            border-left-color: #ef4444;
        }
        
        .event-status {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 20px;
        }
        
        .event-status.authorized {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .event-status.unauthorized {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .event-details {
            flex: 1;
        }
        
        .event-title {
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
        }
        
        .event-meta {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .event-confidence {
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            margin-left: 10px;
        }
        
        .confidence-high {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .confidence-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        .confidence-low {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Système de Sécurité Biométrique</h1>
            <p>Reconnaissance d'Empreintes • Surveillance Avancée • Contrôle d'Accès</p>
            <div class="status-indicator">
                <div class="pulse"></div>
                <span style="color: white; font-weight: 500;">Système Opérationnel</span>
            </div>
        </div>
        
        <div class="nav-bar">
            <button class="nav-btn active" onclick="showPage('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="nav-btn" onclick="showPage('about')">
                <i class="fas fa-user"></i> À Propos
            </button>
        </div>
        
        <div id="dashboard" class="page active">
            <div class="controls">
                <button class="refresh-btn" onclick="loadData()" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> Actualiser
                </button>
            </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                <div class="stat-value" id="total-events">-</div>
                <div class="stat-label">Détections Aujourd'hui</div>
                <div class="stat-trend">Activité quotidienne</div>
            </div>
            <div class="stat-card security">
                <div class="stat-icon"><i class="fas fa-shield-alt"></i></div>
                <div class="stat-value" id="known-events">-</div>
                <div class="stat-label">Accès Autorisés</div>
                <div class="stat-trend">Sécurité maintenue</div>
            </div>
            <div class="stat-card alert">
                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="stat-value" id="unknown-events">-</div>
                <div class="stat-label">Tentatives Non Autorisées</div>
                <div class="stat-trend">Alertes de sécurité</div>
            </div>
            <div class="stat-card performance">
                <div class="stat-icon"><i class="fas fa-bullseye"></i></div>
                <div class="stat-value" id="avg-confidence">-</div>
                <div class="stat-label">Précision du Système</div>
                <div class="stat-trend">Performance globale</div>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="chart-container">
                <div class="section-header">
                    <h3><i class="fas fa-chart-bar"></i> Analyse Temporelle</h3>
                    <p>Distribution de l'activité sur 24 heures</p>
                </div>
                <canvas id="hourlyChart" width="800" height="300"></canvas>
            </div>
            
            <div class="events-section">
                <div class="section-header">
                    <h3><i class="fas fa-list-alt"></i> Journal de Sécurité</h3>
                    <p>Historique des événements en temps réel</p>
                </div>
                <div class="events-container">
                    <div class="events-list" id="events-list">
                        <!-- Events will be populated here -->
                    </div>
                </div>
            </div>
            </div>
        </div>
        
        <div id="about" class="page">
            <div class="about-content">
                <div class="profile-section">
                    <div class="profile-avatar">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="profile-name">Jelly Maweja</div>
                    <div class="profile-title">Software Engineer • Architecte Logiciel • Machine Learning Engineer</div>
                </div>
                
                <div class="section-header">
                    <h3><i class="fas fa-info-circle"></i> À Propos du Projet</h3>
                    <p>Système de sécurité biométrique développé avec des technologies modernes</p>
                </div>
                
                <div style="margin: 30px 0; line-height: 1.6; color: rgba(255,255,255,0.8);">
                    Ce système de sécurité biométrique a été conçu pour offrir une solution complète de contrôle d'accès 
                    basée sur la reconnaissance d'empreintes digitales. Il combine une architecture backend robuste 
                    avec une interface utilisateur moderne pour fournir une surveillance en temps réel et des analyses détaillées.
                </div>
                
                <div class="skills-grid">
                    <div class="skill-card">
                        <div class="skill-icon"><i class="fas fa-code"></i></div>
                        <div class="skill-name">Développement Backend</div>
                        <div class="skill-desc">PHP, MySQL, API REST</div>
                    </div>
                   
                    <div class="skill-card">
                        <div class="skill-icon"><i class="fas fa-shield-alt"></i></div>
                        <div class="skill-name">Sécurité</div>
                        <div class="skill-desc">Authentification biométrique</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="skill-name">Analytics</div>
                        <div class="skill-desc">Visualisation temps réel</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>&copy; 2025 Jelly Maweja. Tous droits réservés.</p>
        </div>
    </div>

    <script>
        async function fetchData(action) {
            try {
                const response = await fetch(`api.php?action=${action}`);
                const data = await response.json();
                if (data.status === 'ok') return data.data;
                throw new Error(data.msg);
            } catch (error) {
                console.error('Erreur:', error);
                return null;
            }
        }

        async function loadStats() {
            const stats = await fetchData('stats');
            if (stats) {
                document.getElementById('total-events').textContent = stats.total || 0;
                document.getElementById('known-events').textContent = stats.known_count || 0;
                document.getElementById('unknown-events').textContent = stats.unknown_count || 0;
                document.getElementById('avg-confidence').textContent = stats.avg_confidence ? Math.round(stats.avg_confidence) + '%' : '0%';
            }
        }

        async function loadEvents() {
            const events = await fetchData('recent');
            const eventsList = document.getElementById('events-list');
            eventsList.innerHTML = '';
            
            if (events && events.length > 0) {
                events.slice(0, 10).forEach(event => {
                    const isAuthorized = event.known == 1;
                    const confidenceClass = event.confidence >= 80 ? 'high' : event.confidence >= 60 ? 'medium' : 'low';
                    
                    const eventItem = document.createElement('div');
                    eventItem.className = `event-item ${isAuthorized ? 'authorized' : 'unauthorized'}`;
                    
                    eventItem.innerHTML = `
                        <div class="event-status ${isAuthorized ? 'authorized' : 'unauthorized'}">
                            <i class="fas ${isAuthorized ? 'fa-check' : 'fa-times'}"></i>
                        </div>
                        <div class="event-details">
                            <div class="event-title">
                                ${isAuthorized ? 'Accès Autorisé' : 'Tentative d\'Intrusion'} - Utilisateur ${event.fp_id}
                            </div>
                            <div class="event-meta">
                                ${new Date(event.ts).toLocaleString('fr-FR')}
                                <span class="event-confidence confidence-${confidenceClass}">
                                    ${event.confidence}%
                                </span>
                            </div>
                        </div>
                    `;
                    
                    eventsList.appendChild(eventItem);
                });
            } else {
                eventsList.innerHTML = '<div style="text-align:center; color:rgba(255,255,255,0.5); padding:40px;">Aucune activité détectée</div>';
            }
        }

        async function loadHourlyChart() {
            const hourlyData = await fetchData('hourly');
            const canvas = document.getElementById('hourlyChart');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (!hourlyData || hourlyData.length === 0) {
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = '16px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('Aucune donnée disponible', canvas.width/2, canvas.height/2);
                return;
            }
            
            const maxCount = Math.max(...hourlyData.map(d => d.count));
            const barWidth = canvas.width / 24;
            const maxBarHeight = canvas.height - 60;
            
            // Gradient pour les barres
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#6366f1');
            gradient.addColorStop(1, '#8b5cf6');
            
            // Dessiner les barres
            hourlyData.forEach(data => {
                const x = data.hour * barWidth;
                const barHeight = maxCount > 0 ? (data.count / maxCount) * maxBarHeight : 0;
                const y = canvas.height - barHeight - 40;
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x + 8, y, barWidth - 16, barHeight);
                
                // Labels
                ctx.fillStyle = 'rgba(255,255,255,0.7)';
                ctx.font = '11px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(data.hour + 'h', x + barWidth/2, canvas.height - 20);
                
                if (data.count > 0) {
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 10px Inter';
                    ctx.fillText(data.count, x + barWidth/2, y - 8);
                }
            });
        }

        async function loadData() {
            const btn = document.getElementById('refreshBtn');
            btn.classList.add('loading');
            
            try {
                await Promise.all([loadStats(), loadEvents(), loadHourlyChart()]);
            } finally {
                setTimeout(() => {
                    btn.classList.remove('loading');
                }, 500);
            }
        }
        
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Charger les données au démarrage
        loadData();
        
        // Actualiser automatiquement toutes les 30 secondes
        setInterval(loadData, 30000);
    </script>
</body>
</html>